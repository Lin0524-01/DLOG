<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.moon.dlog.mapper.PlanMapper">
    <insert id="addPlan">
        insert into plan
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="planName != null">plan_name,</if>
            <if test="planTime != null">plan_time,</if>
            <if test="priority != null">priority,</if>
            <if test="planStatus != null">plan_status,</if>
            <if test="createTime != null">create_time,</if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="planName != null">#{planName},</if>
            <if test="planTime != null">#{planTime},</if>
            <if test="priority != null">#{priority},</if>
            <if test="planStatus != null">#{planStatus},</if>
            <if test="createTime != null">#{createTime},</if>
        </trim>
    </insert>

    <update id="updatePlan">
        update plan
        <trim prefix="set" suffixOverrides=",">
            <if test="planName != null">plan_name = #{planName},</if>
            <if test="planStatus != null">plan_status = #{planStatus},</if>
            <if test="planTime != null">plan_time = #{planTime},</if>
            <if test="priority != null">priority = #{priority},</if>
            <if test="finishTime != null">finish_time = #{finishTime},</if>
            <if test="summaryId != null">summary_id = #{summaryId}</if>
        </trim>
        where id = #{id}
    </update>

    <update id="syncPlanToRecord">
        update plan set record_id = #{id} where create_time >= #{startTime} and create_time &lt;= #{endTime}
    </update>

    <delete id="deletePlanById">
        delete from plan where id = #{id}
    </delete>

    <select id="selectDateFormSpringCalling" resultType="java.lang.Integer">
        SELECT DATEDIFF('2023-03-01',NOW())
    </select>

    <select id="selectPlanList" resultType="com.moon.dlog.domain.Plan">
        select * from plan
        where 1 = 1
          <if test="planName != null">and plan_name like concat('%', #{planName}, '%') </if>
          <if test="priority != null and priority != ''">and priority = #{priority}</if>
          <if test="planStatus != null and planStatus != ''">and plan_status = #{planStatus}</if>
          <if test="startTime != null and startTime != ''">and #{startTime} &lt;= create_time</if>
          <if test="endTime != null and endTime != ''">and #{endTime} >= create_time</if>
        order by create_time desc
    </select>

    <select id="selectPlanById" resultType="com.moon.dlog.domain.Plan">
        select * from plan where id = #{id}
    </select>

    <select id="selectRandomOne" resultType="java.lang.String">
        select dictum_text from dictum where id = #{id}
    </select>

    <select id="selectPlanCountToday" resultType="java.lang.Integer">
        select count(id) from plan
        <where>
            <if test="planStatus != null and planStatus != ''">and plan_status = #{planStatus}</if>
            <if test="startTime != null and startTime != ''">and #{startTime} &lt;= create_time</if>
            <if test="endTime != null and endTime != ''">and #{endTime} >= create_time</if>
        </where>
    </select>

    <select id="selectPlanListToday" resultType="com.moon.dlog.domain.Plan">
        select * from plan where record_id = #{id}
    </select>
</mapper>